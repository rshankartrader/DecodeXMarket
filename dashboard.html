<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DecodeXMarket - Overview & Reel Creator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ===== CSS RESET & VARIABLES ===== */
        :root {
            --primary: #10b981;
            --secondary: #059669;
            --accent: #f43f5e;
            --warning: #f39c12;
            --dark: #0f172a;
            --darker: #0a1120;
            --light: #ecf0f1;
            --gray: #94a3b8;
            --border: #1e293b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .main-container {
            width: 100%;
            max-width: 1400px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }

        /* ===== LEFT PANEL: OVERVIEW BOX ===== */
        .panel-left {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .panel-title {
            color: var(--primary);
            font-size: 20px;
            margin-bottom: 15px;
            text-align: center;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rectangle-box {
            width: 337.5px;
            height: 600px;
            background: linear-gradient(145deg, #0d1525, #111a2d);
            border-radius: 18px;
            border: 3px solid var(--primary);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        /* [Keep ALL your original rectangle-box styles here - .box-header, .section, .levels-row, .contact-info, .disclaimer-box, etc.] */
        /* IMPORTANT: Copy all the CSS styles for the rectangle box from your previous code and paste them right here. */
        /* This includes: .box-header, .section, .prediction-box, .levels-section, .level-value, .reversal-section, .contact-info, .disclaimer-box */
        /* I am omitting them here to avoid duplication, but they MUST be in your final file. */

        /* ===== RIGHT PANEL: REEL CREATOR ===== */
        .panel-right {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 18px;
            border: 2px solid var(--border);
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .preview-container {
            width: 100%;
            aspect-ratio: 9/16;
            max-height: 500px;
            background-color: #111a2d;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
            border: 2px solid var(--border);
        }

        #backgroundPreview {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .text-overlay-preview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            font-weight: 900;
            text-align: center;
            color: white;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.9);
        }

        .bg-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .bg-option {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 2px solid transparent;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .bg-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .bg-option.active {
            border-color: var(--primary);
            background: rgba(16, 185, 129, 0.15);
        }

        .bg-option-title {
            font-size: 14px;
            font-weight: 700;
            color: var(--light);
            margin-bottom: 5px;
        }

        .bg-option-desc {
            font-size: 11px;
            color: var(--gray);
        }

        /* ===== STORYBOARD & CONTROLS ===== */
        .storyboard-box {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid var(--border);
            font-size: 13px;
            line-height: 1.6;
            color: var(--gray);
            white-space: pre-line;
            max-height: 250px;
            overflow-y: auto;
        }

        .storyboard-box strong {
            color: var(--primary);
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-top: 25px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.3);
            flex: 1;
            min-width: 180px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.4);
        }

        .control-btn.secondary {
            background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
        }

        .control-btn.export {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
        }

        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            background: var(--primary);
            color: white;
            padding: 12px 18px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            font-weight: 600;
            font-size: 14px;
            max-width: 300px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- LEFT PANEL: Original Overview Box -->
        <div class="panel-left">
            <h1 class="panel-title"><i class="fas fa-chart-line"></i> Market Overview Generator</h1>
            <div class="rectangle-box" id="overviewBox">
                <!-- [Keep your entire rectangle box HTML structure from the previous code here] -->
                <!-- This includes the box-header, sections for prediction, support/resistance, reversal times, contact info, and disclaimer. -->
            </div>
            <div class="controls">
                <button class="control-btn" onclick="refreshData()"><i class="fas fa-sync-alt"></i> Refresh Data</button>
                <button class="control-btn" onclick="exportAsImage()"><i class="fas fa-download"></i> Export Image</button>
            </div>
        </div>

        <!-- RIGHT PANEL: Reel Creator -->
        <div class="panel-right">
            <h1 class="panel-title"><i class="fas fa-video"></i> Reel Storyboard Creator</h1>
            
            <!-- Background Preview & Selector -->
            <div class="preview-container">
                <video id="backgroundPreview" autoplay loop muted playsinline>
                    <!-- Video source will be set by JavaScript -->
                </video>
                <div class="text-overlay-preview" id="textOverlay">
                    <div style="font-size: 34px; margin-bottom: 10px;">Preview Text</div>
                    <div style="font-size: 18px;">This is how your titles will look.</div>
                </div>
            </div>

            <div class="bg-selector">
                <div class="bg-option active" data-bg="1" data-title="Candlestick Chart" data-desc="Classic market look">
                    <div class="bg-option-title">Chart Style 1</div>
                    <div class="bg-option-desc">Dynamic Candlesticks</div>
                </div>
                <div class="bg-option" data-bg="2" data-title="Multi Chart" data-desc="Energetic & fast-paced">
                    <div class="bg-option-title">Chart Style 2</div>
                    <div class="bg-option-desc">Multiple Charts</div>
                </div>
                <div class="bg-option" data-bg="3" data-title="Abstract Data" data-desc="Modern & clean">
                    <div class="bg-option-title">Abstract Style</div>
                    <div class="bg-option-desc">Gradient & Flow</div>
                </div>
            </div>

            <!-- Generated Storyboard -->
            <div class="storyboard-box" id="storyboard">
                <strong>Your 60-Second Reel Script:</strong>
                <br>Click "Generate Storyboard" to create a timed script based on today's data.
            </div>

            <!-- Reel Controls -->
            <div class="controls">
                <button class="control-btn secondary" onclick="generateStoryboard()">
                    <i class="fas fa-clipboard-list"></i> Generate Storyboard
                </button>
                <button class="control-btn export" onclick="copyStoryboardToClipboard()">
                    <i class="far fa-copy"></i> Copy Script
                </button>
                <button class="control-btn" onclick="window.location.href='index.html'">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
            </div>
        </div>
    </div>

    <!-- Load html2canvas from CDN -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // ========================
        // 1. ORIGINAL DATA & LOGIC
        // ========================
        // [Copy the ENTIRE original JavaScript from your previous overview.html file here]
        // This includes: checkAdminAccess(), parseCSV(), fetchData(), updateOverview(), 
        // updateLevels(), updateReversalTimes(), exportAsImage(), showNotification(), etc.
        // Paste it starting here.

        // ========================
        // 2. REEL CREATOR LOGIC
        // ========================
        const bgVideos = {
            1: "https://drive.google.com/uc?export=download&id=1BBkBnG3nH9Q6bm0jx_tdhiwiiLmSCksw",
            2: "https://drive.google.com/uc?export=download&id=1f3O6G0E1OxUQCsmd6cEPVUOOz8bXMmP6",
            3: "https://drive.google.com/uc?export=download&id=1EL98jvH3KXMdFuoJIuzb7fZhBDF053qh"
        };

        let currentBgId = 1;
        const previewVideo = document.getElementById('backgroundPreview');
        const textOverlay = document.getElementById('textOverlay');
        const storyboardEl = document.getElementById('storyboard');

        // Initialize Background Selector
        document.querySelectorAll('.bg-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.bg-option').forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                
                currentBgId = this.getAttribute('data-bg');
                const title = this.getAttribute('data-title');
                
                // Update preview video
                previewVideo.src = bgVideos[currentBgId];
                previewVideo.load();
                
                // Update preview text
                textOverlay.innerHTML = `<div style="font-size: 38px; margin-bottom: 15px; color: #10b981;">${title}</div>
                                         <div style="font-size: 20px;">Your data will appear here</div>
                                         <div style="font-size: 16px; margin-top: 20px; opacity: 0.9;">Choose "Generate Storyboard"</div>`;
                                         
                showNotification(`Background switched to: ${title}`);
            });
        });

        // Set first background as active on load
        document.querySelector('.bg-option[data-bg="1"]').click();

        // ========================
        // 3. GENERATE STORYBOARD
        // ========================
        function generateStoryboard() {
            // Get current data from the overview box
            const prediction = document.getElementById('finalPrediction').textContent;
            const dateStr = document.getElementById('currentDate').textContent;
            
            // Get resistance and support levels
            const resLevels = Array.from(document.querySelectorAll('.resistance-value')).map(el => el.textContent).slice(0, 3);
            const supLevels = Array.from(document.querySelectorAll('.support-value')).map(el => el.textContent).slice(0, 3);
            
            // Get reversal times
            const reversalItems = Array.from(document.querySelectorAll('.time-value')).map(el => el.textContent);
            
            // Construct the storyboard
            const storyboard = `
=======================
DECODEX MARKET REEL SCRIPT
=======================
Date: ${dateStr}
Background: ${document.querySelector('.bg-option.active').getAttribute('data-title')}
Total Duration: 60 seconds

--- TIMED SCRIPT ---
[0-4 SECONDS]
ðŸŽ¬ HOOK SCENE
"TOMORROW'S NIFTY ACTION PLAN"
(Animated text reveal on chart background)

[4-12 SECONDS]
ðŸ“ˆ KEY PREDICTION
"${prediction}"
(Highlight with icon and emphasis)

[12-22 SECONDS]
âš–ï¸ SUPPORT & RESISTANCE
RESISTANCE: ${resLevels.join(' | ')}
SUPPORT: ${supLevels.join(' | ')}
(Levels slide in one by one)

[22-32 SECONDS]
â° TIMING IS EVERYTHING
Watch for reversals around:
${reversalItems.filter(t => t !== '--:--').map((t, i) => `â€¢ ${t}`).join('\\n')}

[32-48 SECONDS]
ðŸ› ï¸ OUR EXPERT SERVICES
â€¢ ðŸ“Š FIIâ€“DII Data Decoding
â€¢ ðŸ“ˆ Nifty | BankNifty | Sensex
â€¢ â± Intraday Reversal Timings
â€¢ ðŸ§  OI & PCR Based Analysis
(Services appear in list)

[48-55 SECONDS]
ðŸ† BRANDING & CTA
[SHOW: decodexlogo.png]
"Where Data Meets Direction."
ðŸ’¬ Message to learn: 8271890090
ðŸ“¸ Follow @DecodeXMarket

[55-60 SECONDS]
ðŸ” FINAL CTA
"SAVE THIS FOR TOMORROW'S TRADING!"
#DecodeXMarket #Nifty50 #TradingTips

--- NEXT STEPS ---
1. COPY this script.
2. PASTE into CapCut/InShot.
3. Use chosen background video.
4. Add text per this timing.
5. Add a trending audio track.
6. Export and post!

=======================
            `;
            
            storyboardEl.textContent = storyboard;
            showNotification('Storyboard generated! Copy the script.');
        }

        function copyStoryboardToClipboard() {
            const storyboardText = storyboardEl.textContent;
            navigator.clipboard.writeText(storyboardText).then(() => {
                showNotification('Script copied to clipboard! Ready for CapCut.');
            }).catch(err => {
                console.error('Copy failed: ', err);
                showNotification('Copy failed. Please select and copy manually.', 'error');
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Your original data fetch call
            if (checkAdminAccess()) {
                fetchData();
                setInterval(fetchData, 5 * 60 * 1000);
            }
        });
    </script>
</body>
</html>
